#summary How to install the Web front end of kmotion
#labels Phase-Deploy

----

= WARNING =

*PLEASE DO NOT ATTEMPT THIS IF YOU ARE NOT COMFORTABLE WITH COMMAND LINE TOOLS. IT IS POSSIBLE TO SERIOUSLY B0RK YOUR SYSTEM. PLEASE BE CAREFUL & REPORT ANY HOWTO ERRORS*

----

= Introduction =

The web viewer has been developed & runs on a stock kubuntu Gutsy 7.10

motion 3.2.3
PHP    5.2.3
Apache 2.2.4
Python 2.5.1

----

= Optional server setup =

Install a stock Gutsy server with the following additional packages

_sudo apt-get install motion, apache2, python, libapache2-mod-php5, ntp, screen_

Setup server for auto update by adding the following script to /etc/cron.daily
call it auto-update.sh & make it executable

_#!/bin/bash_

_aptitude -y update && aptitude -y safe-upgrade && aptitude -y dist-upgrade && aptitude -y autoclean_

----

= Kmotion daemon (back end) setup =

This will be a KDE app, its config are in the standard KDE dirs, although KDE is not installed you need to pretend it is :)

_mkdir -p ~/.kde/share/apps/kmotion_

_cd ~/.kde/share/apps/kmotion_

_unzip daemons.tar.gz_

The daemons start motion & do all sorts of housekeeping. The daemons need to be started at bootup. Edit /etc/rc.local and add the line

_su dave -c /home/<user name>/.kde/share/apps/kmotion/kmotion_start.py &_

_cd /var/lib_

_sudo chmod 770 www-data_

_sudo chgrp www-data motion_

_sudo vi /etc/group_

add <user name> to www-data group

----

= Kmotion Apache (front end) setup =

_sudo -i_

_cd /var/www_

_mkdir /var/www.bak_

_mv {{{*}}} ../www.bak/_

_unzip apache1.tar.gz_

_cd /etc/apache2_

_mkdir /etc/apache2.bak_

_mv {{{*}}} ../apache2.bak/_

_unzip apache2.tar.gz_

_/etc/init.d/apache2 restart_

----

= Kmotion config notes =

Config comes in two parts, the easy bit first - the Apache loggin :)

_sudo -i_

_cd /var/www_

_htpasswd -c .htpasswd <user name>_

Then enter your web interface loggin password twice. If you do not want a loggin dialogue remove .htaccess & .htpasswd & restart Apache

_/etc/init.d/apache2 restart_

Now difficult bit.

_exit_ ... ie drop out of root back to a normal user

_cd ~/.kde/share/apps/kmotion_

_vi kmotion.rc_

This file configures everything, go have a look ... hopefully its pretty self explanitory

file_system & cull_trigpc trigger auto deleteion of the oldest files when the disk becomes more that cull_trigpc full

feed_common is motion.conf
feed1 - 16 are motion.conf threads

You can put anything in these sections that you can in motions config file with the addition of 'name:' the name of the web view for that feed & 'live:' if the feed is live. motion.conf & its threads are auto generated from this file.

*NOTE* feeds MUST be 'live: yes' from feed1 upwards until a 'live: no' no gaps of 'no' the n 'yes' are allowed

----

= Finally =

Reboot the system, point preferably Firefox to 'localhost' or the IP of your server ... and .... and .... tell me if it breaks - or works ;) ... raise an 'issue' dude.

----

= Problems =

  * If you hit problems check

    _sudo tail - f/var/log/messages_

  * If you are experimenting with kmotion.rc you need to re-init kmotion to re-read the config. Use the following tool

     _~/.kde/share/apps/kmotion/daemon_manual.py_

     option '1' starts the daemons, '2' stops the daemons, '3' will reload the config & '4' quits & kills the daemons. Or you could just re-boot the system :)

  * Inside daemons.tar.gz is a 'knowit' file. _sudo apt-get install knowit_. It is a complete outline of the internal kmotion API

----

= Thanks =

With many thanks to my good friend Keith - a test guinea pig with an unerring ability to spot bugs I would have preffered not to have seen - cheers mate ;) 